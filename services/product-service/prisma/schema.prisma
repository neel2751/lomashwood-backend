generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum ProductCategory {
  KITCHEN
  BEDROOM
}

enum ProductStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum StyleType {
  MODERN
  TRADITIONAL
  CONTEMPORARY
  CLASSIC
  MINIMALIST
  RUSTIC
  SHAKER
  HANDLELESS
  INDUSTRIAL
}

enum FinishType {
  GLOSS
  MATT
  SATIN
  TEXTURED
  WOOD_GRAIN
  METALLIC
  LAMINATE
}

model Product {
  id              String          @id @default(uuid())
  category        ProductCategory
  title           String
  description     String          @db.Text
  price           Decimal?        @db.Decimal(10, 2)
  rangeName       String?
  status          ProductStatus   @default(DRAFT)
  style           StyleType?
  finish          FinishType?
  slug            String          @unique
  metaTitle       String?
  metaDescription String?         @db.Text
  featured        Boolean         @default(false)
  viewCount       Int             @default(0)
  sortOrder       Int             @default(0)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  deletedAt       DateTime?
  createdBy       String?
  updatedBy       String?

  images     ProductImage[]
  colours    ProductColour[]
  units      ProductUnit[]
  sales      SaleProduct[]
  inventory  Inventory?
  pricing    PriceHistory[]

  @@index([category])
  @@index([status])
  @@index([slug])
  @@index([featured])
  @@index([style])
  @@index([finish])
  @@index([rangeName])
  @@index([createdAt])
  @@index([deletedAt])
  @@index([sortOrder])
  @@map("products")
}

model ProductImage {
  id        String   @id @default(uuid())
  productId String
  url       String
  altText   String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([order])
  @@map("product_images")
}

model Colour {
  id          String   @id @default(uuid())
  name        String   @unique
  hexCode     String
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  category    String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?

  products ProductColour[]

  @@index([name])
  @@index([order])
  @@index([deletedAt])
  @@map("colours")
}

model ProductColour {
  id        String   @id @default(uuid())
  productId String
  colourId  String
  createdAt DateTime @default(now())

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  colour  Colour  @relation(fields: [colourId], references: [id], onDelete: Cascade)

  @@unique([productId, colourId])
  @@index([productId])
  @@index([colourId])
  @@map("product_colours")
}

model ProductUnit {
  id          String   @id @default(uuid())
  productId   String
  image       String?
  title       String
  description String?  @db.Text
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([order])
  @@map("product_units")
}

model Category {
  id          String          @id @default(uuid())
  name        String          @unique
  slug        String          @unique
  description String?         @db.Text
  type        ProductCategory
  image       String?
  order       Int             @default(0)
  parentId    String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  deletedAt   DateTime?

  parent   Category?  @relation("CategoryToCategory", fields: [parentId], references: [id])
  children Category[] @relation("CategoryToCategory")

  @@index([slug])
  @@index([type])
  @@index([order])
  @@index([parentId])
  @@index([deletedAt])
  @@map("categories")
}

model Size {
  id        String   @id @default(uuid())
  name      String   @unique
  value     String
  unit      String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?

  @@index([name])
  @@index([order])
  @@index([deletedAt])
  @@map("sizes")
}

model Sale {
  id          String           @id @default(uuid())
  title       String
  description String           @db.Text
  image       String
  startDate   DateTime
  endDate     DateTime
  discount    Decimal?         @db.Decimal(5, 2)
  terms       String?          @db.Text
  category    ProductCategory?
  active      Boolean          @default(true)
  slug        String           @unique
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  deletedAt   DateTime?
  createdBy   String?
  updatedBy   String?

  products SaleProduct[]

  @@index([active])
  @@index([startDate])
  @@index([endDate])
  @@index([category])
  @@index([slug])
  @@index([deletedAt])
  @@map("sales")
}

model SaleProduct {
  id        String   @id @default(uuid())
  saleId    String
  productId String
  createdAt DateTime @default(now())

  sale    Sale    @relation(fields: [saleId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([saleId, productId])
  @@index([saleId])
  @@index([productId])
  @@map("sale_products")
}

model Package {
  id          String           @id @default(uuid())
  title       String
  description String           @db.Text
  image       String
  price       Decimal?         @db.Decimal(10, 2)
  category    ProductCategory?
  active      Boolean          @default(true)
  slug        String           @unique
  features    Json?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  deletedAt   DateTime?
  createdBy   String?
  updatedBy   String?

  @@index([active])
  @@index([category])
  @@index([slug])
  @@index([deletedAt])
  @@map("packages")
}

model Inventory {
  id            String   @id @default(uuid())
  productId     String   @unique
  quantity      Int      @default(0)
  reserved      Int      @default(0)
  available     Int      @default(0)
  lowStockAlert Int      @default(10)
  lastRestocked DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([quantity])
  @@index([available])
  @@index([lowStockAlert])
  @@map("inventory")
}

model PriceHistory {
  id        String   @id @default(uuid())
  productId String
  oldPrice  Decimal? @db.Decimal(10, 2)
  newPrice  Decimal  @db.Decimal(10, 2)
  reason    String?
  changedAt DateTime @default(now())
  changedBy String?

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([changedAt])
  @@map("price_history")
}
