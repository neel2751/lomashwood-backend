import { RefundStatus, RefundType } from '../../src/shared/types';
import {
  makeId,
  makeDate,
  FIXED_DATE,
  CUSTOMER_ID_1,
  CUSTOMER_ID_2,
  CUSTOMER_ID_3,
  ADMIN_USER_ID,
  CURRENCY_GBP,
} from './common.fixture';
import { PAYMENT_REFUNDED, PAYMENT_PARTIALLY_REFUNDED } from './payments.fixture';
import { ORDER_REFUNDED } from './orders.fixture';

export const REFUND_FULL_SUCCEEDED = {
  id: makeId(),
  paymentId: PAYMENT_REFUNDED.id,
  orderId: ORDER_REFUNDED.id,
  customerId: CUSTOMER_ID_3,
  type: RefundType.FULL,
  status: RefundStatus.SUCCEEDED,
  reason: 'CUSTOMER_REQUEST',
  note: 'Customer changed mind before delivery',
  amount: 3838.80,
  currency: CURRENCY_GBP,
  stripeRefundId: 're_3OxKpLF1234567890ABCD',
  stripeChargeId: PAYMENT_REFUNDED.stripeChargeId,
  stripeBalanceTransactionId: 'txn_refund_3OxKpLF1234567890ABCD',
  initiatedByUserId: null,
  initiatedBy: 'CUSTOMER' as const,
  initiatedAt: makeDate(-2),
  createdAt: makeDate(-2),
  updatedAt: makeDate(-2),
};

export const REFUND_PARTIAL_SUCCEEDED = {
  id: makeId(),
  paymentId: PAYMENT_PARTIALLY_REFUNDED.id,
  orderId: PAYMENT_PARTIALLY_REFUNDED.orderId,
  customerId: CUSTOMER_ID_2,
  type: RefundType.PARTIAL,
  status: RefundStatus.SUCCEEDED,
  reason: 'PRODUCT_UNAVAILABLE',
  note: 'Bedroom unit out of stock â€” partial refund issued for bedroom items',
  amount: 3199.00,
  currency: CURRENCY_GBP,
  stripeRefundId: 're_3OxKpLF1234567890BCDE',
  stripeChargeId: PAYMENT_PARTIALLY_REFUNDED.stripeChargeId,
  stripeBalanceTransactionId: 'txn_refund_3OxKpLF1234567890BCDE',
  initiatedByUserId: ADMIN_USER_ID,
  initiatedBy: 'ADMIN' as const,
  initiatedAt: makeDate(-1),
  createdAt: makeDate(-1),
  updatedAt: makeDate(-1),
};

export const REFUND_PENDING = {
  id: makeId(),
  paymentId: makeId(),
  orderId: makeId(),
  customerId: CUSTOMER_ID_1,
  type: RefundType.FULL,
  status: RefundStatus.PENDING,
  reason: 'DEFECTIVE_ITEM',
  note: 'Unit arrived damaged',
  amount: 2499.00,
  currency: CURRENCY_GBP,
  stripeRefundId: null,
  stripeChargeId: null,
  stripeBalanceTransactionId: null,
  initiatedByUserId: null,
  initiatedBy: 'CUSTOMER' as const,
  initiatedAt: FIXED_DATE,
  createdAt: FIXED_DATE,
  updatedAt: FIXED_DATE,
};

export const REFUND_PROCESSING = {
  id: makeId(),
  paymentId: makeId(),
  orderId: makeId(),
  customerId: CUSTOMER_ID_2,
  type: RefundType.PARTIAL,
  status: RefundStatus.PROCESSING,
  reason: 'PRICING_ERROR',
  note: 'Incorrect price charged at checkout',
  amount: 300.00,
  currency: CURRENCY_GBP,
  stripeRefundId: 're_3OxKpLF1234567890CDEF',
  stripeChargeId: 'ch_3OxKpLF1234567890MOCKX',
  stripeBalanceTransactionId: null,
  initiatedByUserId: ADMIN_USER_ID,
  initiatedBy: 'ADMIN' as const,
  initiatedAt: FIXED_DATE,
  createdAt: FIXED_DATE,
  updatedAt: FIXED_DATE,
};

export const REFUND_FAILED = {
  id: makeId(),
  paymentId: makeId(),
  orderId: makeId(),
  customerId: CUSTOMER_ID_3,
  type: RefundType.FULL,
  status: RefundStatus.FAILED,
  reason: 'CUSTOMER_REQUEST',
  note: null,
  amount: 3838.80,
  currency: CURRENCY_GBP,
  stripeRefundId: 're_3OxKpLF1234567890DEFG',
  stripeChargeId: 'ch_3OxKpLF1234567890MOCKY',
  stripeBalanceTransactionId: null,
  initiatedByUserId: null,
  initiatedBy: 'CUSTOMER' as const,
  initiatedAt: makeDate(-3),
  createdAt: makeDate(-3),
  updatedAt: makeDate(-3),
};

export const REFUND_SYSTEM_INITIATED = {
  id: makeId(),
  paymentId: makeId(),
  orderId: makeId(),
  customerId: CUSTOMER_ID_1,
  type: RefundType.FULL,
  status: RefundStatus.SUCCEEDED,
  reason: 'ORDER_CANCELLED',
  note: 'Auto-refund triggered by order cancellation',
  amount: 2998.80,
  currency: CURRENCY_GBP,
  stripeRefundId: 're_3OxKpLF1234567890EFGH',
  stripeChargeId: 'ch_3OxKpLF1234567890MOCKZ',
  stripeBalanceTransactionId: 'txn_refund_3OxKpLF1234567890EFGH',
  initiatedByUserId: null,
  initiatedBy: 'SYSTEM' as const,
  initiatedAt: makeDate(-1),
  createdAt: makeDate(-1),
  updatedAt: makeDate(-1),
};

export const STRIPE_REFUND_MOCK = {
  id: 're_3OxKpLF1234567890ABCD',
  object: 'refund',
  amount: 383880,
  currency: 'gbp',
  payment_intent: PAYMENT_REFUNDED.stripePaymentIntentId,
  charge: PAYMENT_REFUNDED.stripeChargeId,
  status: 'succeeded',
  reason: 'requested_by_customer',
  balance_transaction: 'txn_refund_3OxKpLF1234567890ABCD',
  created: Math.floor(makeDate(-2).getTime() / 1000),
};

export const ALL_REFUNDS = [
  REFUND_FULL_SUCCEEDED,
  REFUND_PARTIAL_SUCCEEDED,
  REFUND_PENDING,
  REFUND_PROCESSING,
  REFUND_FAILED,
  REFUND_SYSTEM_INITIATED,
];