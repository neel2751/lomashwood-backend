apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: lomash-wood-dev

namePrefix: dev-

commonLabels:
  environment: development
  app.kubernetes.io/managed-by: kustomize

commonAnnotations:
  deployment.lomashwood.co.uk/environment: development
  deployment.lomashwood.co.uk/managed-by: kustomize

resources:
  - ../../base/namespace.yaml
  - ../../base/configmap.yaml
  - ../../base/secrets.yaml
  - ../../base/deployments/api-gateway.yaml
  - ../../base/deployments/auth-service.yaml
  - ../../base/deployments/product-service.yaml
  - ../../base/deployments/order-payment-service.yaml
  - ../../base/deployments/appointment-service.yaml
  - ../../base/deployments/content-service.yaml
  - ../../base/deployments/customer-service.yaml
  - ../../base/deployments/notification-service.yaml
  - ../../base/deployments/analytics-service.yaml
  - ../../base/services/api-gateway.yaml
  - ../../base/services/auth-service.yaml
  - ../../base/services/product-service.yaml
  - ../../base/services/order-payment-service.yaml
  - ../../base/services/appointment-service.yaml
  - ../../base/services/content-service.yaml
  - ../../base/services/customer-service.yaml
  - ../../base/services/notification-service.yaml
  - ../../base/services/analytics-service.yaml
  - ../../base/ingress/api-gateway-ingress.yaml
  - ../../base/ingress/internal-services-ingress.yaml
  - ../../base/monitoring/servicemonitors.yaml

patches:
  - path: patches/api-gateway.yaml
    target:
      kind: Deployment
      name: api-gateway
  - path: patches/auth-service.yaml
    target:
      kind: Deployment
      name: auth-service
  - path: patches/product-service.yaml
    target:
      kind: Deployment
      name: product-service
  - path: patches/order-payment-service.yaml
    target:
      kind: Deployment
      name: order-payment-service
  - path: patches/appointment-service.yaml
    target:
      kind: Deployment
      name: appointment-service
  - path: patches/content-service.yaml
    target:
      kind: Deployment
      name: content-service
  - path: patches/customer-service.yaml
    target:
      kind: Deployment
      name: customer-service
  - path: patches/notification-service.yaml
    target:
      kind: Deployment
      name: notification-service
  - path: patches/analytics-service.yaml
    target:
      kind: Deployment
      name: analytics-service

configMapGenerator:
  - name: api-gateway-config
    behavior: merge
    literals:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - LOG_FORMAT=pretty
      - CORS_ORIGIN=http://localhost:3000,http://localhost:5173,http://localhost:4000
      - RATE_LIMIT_MAX_REQUESTS=1000
      - AUTH_SERVICE_URL=http://dev-auth-service.lomash-wood-dev.svc.cluster.local:3001
      - PRODUCT_SERVICE_URL=http://dev-product-service.lomash-wood-dev.svc.cluster.local:3002
      - ORDER_PAYMENT_SERVICE_URL=http://dev-order-payment-service.lomash-wood-dev.svc.cluster.local:3003
      - APPOINTMENT_SERVICE_URL=http://dev-appointment-service.lomash-wood-dev.svc.cluster.local:3004
      - CONTENT_SERVICE_URL=http://dev-content-service.lomash-wood-dev.svc.cluster.local:3005
      - CUSTOMER_SERVICE_URL=http://dev-customer-service.lomash-wood-dev.svc.cluster.local:3006
      - NOTIFICATION_SERVICE_URL=http://dev-notification-service.lomash-wood-dev.svc.cluster.local:3007
      - ANALYTICS_SERVICE_URL=http://dev-analytics-service.lomash-wood-dev.svc.cluster.local:3008
  - name: auth-service-config
    behavior: merge
    literals:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - LOG_FORMAT=pretty
      - SESSION_COOKIE_SECURE=false
      - BCRYPT_SALT_ROUNDS=10
  - name: product-service-config
    behavior: merge
    literals:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - LOG_FORMAT=pretty
      - REDIS_CACHE_TTL_SECONDS=60
  - name: order-payment-service-config
    behavior: merge
    literals:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - LOG_FORMAT=pretty
      - STRIPE_API_VERSION=2024-11-20.acacia
  - name: appointment-service-config
    behavior: merge
    literals:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - LOG_FORMAT=pretty
  - name: content-service-config
    behavior: merge
    literals:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - LOG_FORMAT=pretty
      - CDN_BASE_URL=http://localhost:9000
  - name: customer-service-config
    behavior: merge
    literals:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - LOG_FORMAT=pretty
  - name: notification-service-config
    behavior: merge
    literals:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - LOG_FORMAT=pretty
      - EMAIL_PROVIDER=nodemailer
  - name: analytics-service-config
    behavior: merge
    literals:
      - NODE_ENV=development
      - LOG_LEVEL=debug
      - LOG_FORMAT=pretty

images:
  - name: lomashwood/api-gateway
    newTag: dev
  - name: lomashwood/auth-service
    newTag: dev
  - name: lomashwood/product-service
    newTag: dev
  - name: lomashwood/order-payment-service
    newTag: dev
  - name: lomashwood/appointment-service
    newTag: dev
  - name: lomashwood/content-service
    newTag: dev
  - name: lomashwood/customer-service
    newTag: dev
  - name: lomashwood/notification-service
    newTag: dev
  - name: lomashwood/analytics-service
    newTag: dev