apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "analytics-service.fullname" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "analytics-service.labels" . | nindent 4 }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secretsmanager
    kind: ClusterSecretStore
  target:
    name: {{ .Values.secrets.existingSecret | default (include "analytics-service.fullname" .) }}
    creationPolicy: Owner
    deletionPolicy: Retain
    template:
      type: Opaque
  data:
    - secretKey: DATABASE_URL
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/analytics-service
        property: DATABASE_URL

    - secretKey: REDIS_URL
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/analytics-service
        property: REDIS_URL

    - secretKey: KAFKA_BROKERS
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/analytics-service
        property: KAFKA_BROKERS

    - secretKey: JWT_SECRET
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: JWT_SECRET

    - secretKey: SERVICE_TOKEN_SECRET
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: SERVICE_TOKEN_SECRET

    - secretKey: AWS_REGION
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/analytics-service
        property: AWS_REGION

    - secretKey: AWS_ACCESS_KEY_ID
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/analytics-service
        property: AWS_ACCESS_KEY_ID

    - secretKey: AWS_SECRET_ACCESS_KEY
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/analytics-service
        property: AWS_SECRET_ACCESS_KEY

    - secretKey: TWILIO_ACCOUNT_SID
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: TWILIO_ACCOUNT_SID

    - secretKey: TWILIO_AUTH_TOKEN
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: TWILIO_AUTH_TOKEN

    - secretKey: TWILIO_FROM
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: TWILIO_FROM

    - secretKey: MSG91_AUTH_KEY
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: MSG91_AUTH_KEY

    - secretKey: MSG91_SENDER_ID
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: MSG91_SENDER_ID

    - secretKey: FIREBASE_PROJECT_ID
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: FIREBASE_PROJECT_ID

    - secretKey: FIREBASE_SERVICE_ACCOUNT_JSON
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: FIREBASE_SERVICE_ACCOUNT_JSON

    - secretKey: VAPID_PUBLIC_KEY
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: VAPID_PUBLIC_KEY

    - secretKey: VAPID_PRIVATE_KEY
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: VAPID_PRIVATE_KEY

    - secretKey: VAPID_SUBJECT
      remoteRef:
        key: lomash-wood/{{ .Values.env.NODE_ENV }}/shared
        property: VAPID_SUBJECT