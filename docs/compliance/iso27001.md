# ISO 27001 Compliance — Lomash Wood Backend

## Overview

This document maps the Lomash Wood backend architecture and operational practices to the ISO/IEC 27001:2022 standard for Information Security Management Systems (ISMS). ISO 27001 certification is a target for Lomash Wood as the business scales. This document serves as the gap analysis baseline and control implementation reference.

**Standard:** ISO/IEC 27001:2022
**Certification Status:** Target — preparation in progress
**ISMS Scope:** Lomash Wood backend systems, infrastructure, and operational processes supporting the kitchen and bedroom design and consultation platform
**ISMS Owner:** Engineering Manager
**Internal Auditor:** DPO / Lead Security Engineer
**Target Certification Date:** To be determined

---

## Clause 4 — Context of the Organisation

### 4.1 Understanding the Organisation and Its Context

**Internal factors:**
- Microservices architecture on AWS EKS (Kubernetes)
- TypeScript/Node.js engineering team
- PostgreSQL databases managed via Prisma ORM
- Stripe for payment processing
- Git-based deployment via GitHub Actions

**External factors:**
- UK GDPR and EU GDPR regulatory requirements
- PCI-DSS SAQ A obligations
- Customer trust expectations in home improvement sector
- UK ICO oversight

### 4.2 Interested Parties

| Party | Information Security Requirement |
|-------|----------------------------------|
| Customers | Confidentiality of personal and payment data |
| Stripe | PCI-DSS SAQ A compliance; webhook security |
| AWS | Shared responsibility model adherence |
| ICO (UK) | UK GDPR compliance |
| Engineering team | Secure development practices; access controls |
| Management | Operational continuity; risk management |

### 4.3 ISMS Scope

The ISMS covers all systems listed in the backend project structure (`lomash-wood-backend/`), the AWS infrastructure defined in `infra/`, and the operational processes documented in `docs/`.

Out of scope: Customer browser environments; Stripe's internal systems; third-party CMS tools not hosted by Lomash Wood.

---

## Clause 5 — Leadership

### 5.1 Leadership Commitment

The CTO is the executive sponsor of the ISMS. The Engineering Manager owns day-to-day ISMS operations. Security responsibilities are embedded in the engineering culture, not siloed.

### 5.2 Information Security Policy

The top-level information security policy is:

> Lomash Wood is committed to protecting the confidentiality, integrity, and availability of all information assets. Security controls are applied proportionally to risk, and all staff are accountable for maintaining the security of systems and data within their remit.

Subordinate policies:
- `security/policies/auth-policy.md`
- `security/policies/password-policy.md`
- `security/policies/api-security.md`
- `security/policies/encryption-policy.md`
- `security/policies/data-retention.md`
- `security/policies/incident-response.md`

### 5.3 Roles and Responsibilities

| Role | ISMS Responsibility |
|------|---------------------|
| CTO | Executive accountability; risk acceptance authority |
| Engineering Manager | ISMS owner; internal audit coordination |
| Lead Backend Engineer | Secure architecture decisions; code review authority |
| DPO | GDPR interface; breach notification authority |
| DevOps Engineer | Infrastructure security; secrets management |
| All engineers | Adherence to coding standards; incident reporting |

---

## Clause 6 — Planning

### 6.1 Information Security Risk Assessment

**Risk assessment methodology:** Asset-based risk assessment. Risks are scored as:

`Risk = Likelihood (1–5) × Impact (1–5)`

| Risk ID | Asset | Threat | Likelihood | Impact | Score | Treatment |
|---------|-------|--------|------------|--------|-------|-----------|
| R-001 | `lomash_orders` DB | SQL injection | 2 | 5 | 10 | Mitigate — Prisma ORM, input validation |
| R-002 | JWT secret | Secret exposure via Git | 2 | 5 | 10 | Mitigate — AWS Secrets Manager, pre-commit hooks |
| R-003 | Stripe keys | Key compromise | 2 | 5 | 10 | Mitigate — Secrets Manager, key rotation |
| R-004 | Auth service | Brute force on login | 3 | 4 | 12 | Mitigate — rate limiting, account lockout, CAPTCHA |
| R-005 | S3 media bucket | Public access misconfiguration | 2 | 3 | 6 | Mitigate — block public access policy, SCPs |
| R-006 | RDS databases | Unencrypted backup exposure | 1 | 5 | 5 | Mitigate — AES-256 encryption, KMS |
| R-007 | EKS cluster | Compromised container image | 2 | 4 | 8 | Mitigate — image scanning, pinned digests, IRSA |
| R-008 | Customer PII | Insider data exfiltration | 1 | 5 | 5 | Mitigate — audit logging, least privilege, DLP |
| R-009 | All services | DDoS attack | 3 | 3 | 9 | Mitigate — AWS Shield, rate limiting, WAF |
| R-010 | Redis | Session hijacking | 2 | 4 | 8 | Mitigate — TLS, network policy, short TTL |

### 6.2 Information Security Objectives

| Objective | Measure | Target | Review Period |
|-----------|---------|--------|---------------|
| Zero critical vulnerabilities in production | Trivy scan results | 0 CRITICAL findings unpatched > 7 days | Monthly |
| All PRs reviewed for security impact | GitHub PR reviews | 100% of payment/auth PRs reviewed by Lead | Per PR |
| Secrets never committed to Git | Pre-commit hook detections | 0 incidents | Continuously |
| Access reviews completed | Quarterly access review completion | 100% | Quarterly |
| Incident response < 72 hours for P0 | Post-mortem records | 100% of P0 incidents | Per incident |

---

## Annex A Controls Implementation

### A.5 — Organisational Controls

**A.5.1 Policies for information security**
Policies maintained in `security/policies/`. Reviewed annually.

**A.5.2 Information security roles and responsibilities**
Defined in Clause 5.3 above and in job descriptions.

**A.5.7 Threat intelligence**
AWS Security Hub, GitHub Dependabot alerts, and NVD feeds are monitored. Critical CVEs trigger immediate patch tickets.

**A.5.15 Access control**
Role-based access control (RBAC) is implemented in the auth-service:

```typescript
// auth-service: src/app/roles/role.constants.ts
export const ROLES = {
  SUPER_ADMIN: 'super_admin',
  ADMIN: 'admin',
  CONSULTANT: 'consultant',
  CUSTOMER: 'customer',
} as const;
```

**A.5.23 Information security for use of cloud services**
AWS shared responsibility model is documented. Lomash Wood is responsible for: OS hardening, container security, application security, IAM, data classification. AWS is responsible for: physical security, hypervisor, managed service availability.

**A.5.30 ICT readiness for business continuity**
Covered in `docs/disaster-recovery/`. RTO and RPO are defined in `rpo-rto.md`.

### A.6 — People Controls

**A.6.1 Screening**
Background checks are conducted for all staff with access to production systems.

**A.6.3 Information security awareness, education and training**
Annual security awareness training is mandatory for all engineers. Completion is tracked.

**A.6.4 Disciplinary process**
Violations of security policy are subject to the HR disciplinary process, up to and including termination for deliberate breaches.

**A.6.5 Responsibilities after termination**
Offboarding checklist includes: revoking AWS IAM access, GitHub organisation membership, Stripe dashboard access, PagerDuty access, Slack access. Access must be revoked within 24 hours of departure.

### A.7 — Physical Controls

**A.7.1 Physical security perimeters**
All production infrastructure is hosted in AWS data centres (ISO 27001 certified). No Lomash Wood-owned physical servers.

**A.7.8 Equipment siting and protection**
Developer workstations have full-disk encryption (FileVault/BitLocker) enforced via MDM.

### A.8 — Technological Controls

**A.8.2 Privileged access rights**

```bash
aws iam list-users --query 'Users[*].UserName' --output table
aws iam list-attached-user-policies --user-name <username>
```

Quarterly review: remove any user whose access is no longer required.

**A.8.3 Information access restriction**

Production database access requires:
1. VPN connection
2. Bastion host (MFA enforced)
3. Individual named IAM role (no shared credentials)
4. Access logged to CloudTrail

No developer has persistent production DB write access. Emergency access follows the `break-glass` procedure.

**A.8.4 Access to source code**

GitHub repository access is role-based. Production deployment permissions are restricted to the CI/CD service account. Branch protection rules enforce:
- Required PR reviews (minimum 1)
- Required status checks (CI must pass)
- No force push to `main`

**A.8.7 Protection against malware**

Container images are built from pinned base images and scanned with Trivy on every CI run. Images with CRITICAL vulnerabilities are blocked from deployment.

**A.8.8 Management of technical vulnerabilities**

```bash
npm audit --audit-level=moderate
trivy fs --severity HIGH,CRITICAL .
```

Vulnerability SLA:
- CRITICAL: Patch within 24 hours
- HIGH: Patch within 7 days
- MEDIUM: Patch within 30 days
- LOW: Patch within 90 days

**A.8.9 Configuration management**

All infrastructure is defined as code (Terraform, Kubernetes manifests, Helm charts). No manual configuration changes to production. All changes are peer-reviewed via GitHub PRs.

**A.8.12 Data leakage prevention**

- PII fields are not logged in production (structured logging with field redaction).
- Database exports require DPO approval.
- S3 buckets block all public access at the account level via SCP.

**A.8.15 Logging**

Structured JSON logs are collected by Promtail and shipped to Loki. Log schema:

```json
{
  "timestamp": "2026-02-19T10:30:00.000Z",
  "level": "info",
  "service": "order-payment-service",
  "requestId": "req_abc123",
  "userId": "usr_xyz",
  "event": "payment_intent_created",
  "orderId": "ord_def456",
  "duration_ms": 234
}
```

PII (email, phone, address) is never written to logs in production.

**A.8.16 Monitoring activities**

Monitoring stack:
- Prometheus — metrics collection
- Grafana — dashboards and alerting
- Loki — log aggregation
- Tempo — distributed tracing
- Sentry — error tracking
- AWS CloudTrail — API audit trail
- AWS GuardDuty — threat detection

**A.8.20 Networks security**

- Production workloads run in private subnets
- Security groups follow deny-by-default
- Kubernetes NetworkPolicies restrict pod-to-pod communication
- WAF is attached to the ALB

**A.8.23 Web filtering**

AWS WAF rules applied to the ALB:
- AWS Managed Rules (Common Rule Set)
- AWS Managed Rules (Known Bad Inputs)
- Rate-based rules (1000 requests / 5 minutes per IP)
- Geo-restriction (if required)

**A.8.24 Use of cryptography**

Encryption standards:
- Passwords: bcrypt (cost factor 12)
- Data at rest: AES-256
- Data in transit: TLS 1.2+
- JWT: RS256 (asymmetric) in production
- Secrets: AWS KMS managed keys

**A.8.25 Secure development lifecycle**

Security gates in the CI/CD pipeline:
1. `npm audit` — dependency vulnerability scan
2. ESLint security rules — static code analysis
3. Trivy — container image scan
4. SAST — optional integration with CodeQL
5. PR review — human security review for sensitive changes

**A.8.28 Secure coding**

- Zod validation on all API inputs
- Prisma ORM prevents raw SQL injection
- No `eval()`, `innerHTML`, or `document.write()` usage (enforced by ESLint)
- CORS restricted to known origins
- Helmet.js middleware applied to all HTTP responses
- CSP headers enforced on web-facing endpoints

**A.8.29 Security testing in development and acceptance**

- Unit tests include security-related test cases (e.g., invalid tokens, SQL-like inputs)
- Integration tests verify auth middleware is applied to protected routes
- E2E tests validate end-to-end auth flows
- Penetration test annually (results in `security/pentest-reports/`)

**A.8.32 Change management**

All changes follow the branching strategy in `docs/onboarding/branching-strategy.md`:
- Feature branch → PR → CI checks → Review → Merge to `main`
- Production deployments require manual approval step in GitHub Actions

**A.8.33 Test information**

Production data is never used in test environments. Faker.js seed data is used in all non-production environments. See `tools/seed-generator/`.

**A.8.34 Protection of information systems during audit testing**

Penetration tests are conducted against a production-mirror staging environment, not live production, unless explicitly scoped and approved.

---

## Internal Audit Schedule

| Audit Area | Frequency | Owner |
|-----------|-----------|-------|
| Access rights review | Quarterly | Engineering Manager |
| Secret rotation verification | Quarterly | DevOps Engineer |
| Vulnerability scan review | Monthly | Lead Backend Engineer |
| Logging and monitoring effectiveness | Quarterly | DevOps Engineer |
| Policy review | Annually | DPO + Engineering Manager |
| Full ISMS internal audit | Annually | Engineering Manager |

---

## Management Review

The ISMS management review is conducted annually, covering:
- Results of internal audits
- Status of corrective actions
- Changes in context and risk landscape
- Opportunities for continual improvement
- Resource requirements

Next management review: February 2027.